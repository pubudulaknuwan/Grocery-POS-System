<UserControl x:Class="VillageSmartPOS.Views.InventoryManagementPage"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="clr-namespace:VillageSmartPOS.ViewModels"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             d:DesignWidth="800" d:DesignHeight="600"
             Background="{DynamicResource PrimaryBackground}">
    
    <UserControl.DataContext>
        <vm:InventoryViewModel />
    </UserControl.DataContext>

    <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Auto">
        <Grid Margin="20" MinWidth="800">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Header Section -->
            <Border Grid.Row="0" Background="{DynamicResource PrimaryButton}" CornerRadius="12" Padding="20" Margin="0,0,0,20">
                <StackPanel>
                    <TextBlock Text="ðŸ“¦ Inventory Management" 
                               FontSize="24" FontWeight="Bold" 
                               Foreground="White" HorizontalAlignment="Center"/>
                    <TextBlock Text="Manage your product inventory, track stock levels, and update product information" 
                               FontSize="12" Foreground="White" 
                               HorizontalAlignment="Center" Margin="0,8,0,0" Opacity="0.9"/>
                </StackPanel>
            </Border>

            <!-- Main Content -->
            <Grid Grid.Row="1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="2*" MinWidth="500"/>
                    <ColumnDefinition Width="1*" MinWidth="300"/>
                </Grid.ColumnDefinitions>

                <!-- Left Panel: Products List -->
                <Border Grid.Column="0" Background="{DynamicResource CardBackground}" CornerRadius="12" Margin="0,0,15,0" 
                        Effect="{DynamicResource ModernCardShadow}">
                    <Grid Margin="20">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- Search and Actions Header -->
                        <Border Grid.Row="0" Background="{DynamicResource SecondaryBackground}" CornerRadius="8" Padding="15" Margin="0,0,0,15">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                
                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="ðŸ” Search Products" 
                                               FontSize="16" FontWeight="Bold" 
                                               Foreground="{DynamicResource PrimaryText}" 
                                               Margin="0,0,0,8"/>
                                    <TextBox Text="{Binding SearchTerm, UpdateSourceTrigger=PropertyChanged}" 
                                             FontSize="14" Padding="12,8" BorderThickness="0"
                                             Background="Transparent" Foreground="{DynamicResource PrimaryText}"
                                             Style="{DynamicResource ModernTextBox}"
                                             VerticalContentAlignment="Center"
                                             ToolTip="Enter product name, barcode, or category to search"/>
                                </StackPanel>
                                
                                <Button Grid.Column="1" Content="ðŸ” Search" Command="{Binding SearchCommand}"
                                        Width="100" Height="35" Margin="10,0,0,0" 
                                        Background="{DynamicResource SuccessButton}" Foreground="White"
                                        FontWeight="Bold" FontSize="13"
                                        Style="{DynamicResource ModernButton}"/>
                                
                                <Button Grid.Column="2" Content="âš ï¸ Low Stock" Command="{Binding ShowLowStockCommand}"
                                        Width="120" Height="35" Margin="10,0,0,0" 
                                        Background="{DynamicResource WarningButton}" Foreground="White"
                                        FontWeight="Bold" FontSize="13"
                                        Style="{DynamicResource ModernButton}"/>
                            </Grid>
                        </Border>

                        <!-- Products DataGrid -->
                        <Border Grid.Row="1" Background="{DynamicResource CardBackground}" CornerRadius="8" 
                                BorderBrush="{DynamicResource BorderColor}" BorderThickness="1">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>
                                
                                <!-- DataGrid Header -->
                                <Border Grid.Row="0" Background="{DynamicResource PrimaryButton}" CornerRadius="8,8,0,0" Padding="15">
                                    <StackPanel>
                                        <TextBlock Text="ðŸ“‹ Product Inventory" 
                                                   FontSize="18" FontWeight="Bold" 
                                                   Foreground="White" HorizontalAlignment="Center"/>
                                        <TextBlock Text="Current products in your inventory with pricing and stock information" 
                                                   FontSize="12" Foreground="White" 
                                                   HorizontalAlignment="Center" Margin="0,5,0,0" Opacity="0.9"/>
                                    </StackPanel>
                                </Border>
                                
                                <!-- DataGrid -->
                                <DataGrid Grid.Row="1" ItemsSource="{Binding Products}" SelectedItem="{Binding SelectedProduct}" 
                                          AutoGenerateColumns="False" GridLinesVisibility="Horizontal" 
                                          CanUserAddRows="False" CanUserDeleteRows="False" 
                                          SelectionMode="Single"
                                          Background="{DynamicResource CardBackground}"
                                          BorderBrush="{DynamicResource BorderColor}"
                                          Style="{DynamicResource ModernDataGrid}">
                                    <DataGrid.Resources>
                                        <!-- DataGrid Header Style -->
                                        <Style TargetType="DataGridColumnHeader">
                                            <Setter Property="Background" Value="{DynamicResource PrimaryButton}"/>
                                            <Setter Property="Foreground" Value="White"/>
                                            <Setter Property="BorderBrush" Value="{DynamicResource BorderColor}"/>
                                            <Setter Property="BorderThickness" Value="0,0,1,1"/>
                                            <Setter Property="Padding" Value="12,8"/>
                                            <Setter Property="FontWeight" Value="SemiBold"/>
                                            <Setter Property="FontSize" Value="13"/>
                                        </Style>
                                        
                                        <!-- DataGrid Row Style -->
                                        <Style TargetType="DataGridRow">
                                            <Setter Property="Background" Value="{DynamicResource CardBackground}"/>
                                            <Setter Property="Foreground" Value="{DynamicResource PrimaryText}"/>
                                            <Setter Property="BorderBrush" Value="{DynamicResource BorderColor}"/>
                                            <Setter Property="BorderThickness" Value="0,0,0,1"/>
                                            <Style.Triggers>
                                                <Trigger Property="IsSelected" Value="True">
                                                    <Setter Property="Background" Value="{DynamicResource PrimaryButton}"/>
                                                    <Setter Property="Foreground" Value="White"/>
                                                </Trigger>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter Property="Background" Value="{DynamicResource SecondaryBackground}"/>
                                                </Trigger>
                                            </Style.Triggers>
                                        </Style>
                                    </DataGrid.Resources>
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="150"/>
                                        <DataGridTextColumn Header="Barcode" Binding="{Binding Barcode}" Width="100"/>
                                        <DataGridTextColumn Header="Marked Price" Binding="{Binding MarkedPrice}" Width="100">
                                            <DataGridTextColumn.ElementStyle>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="Foreground" Value="{DynamicResource WarningButton}"/>
                                                    <Setter Property="TextDecorations" Value="Strikethrough"/>
                                                </Style>
                                            </DataGridTextColumn.ElementStyle>
                                        </DataGridTextColumn>
                                        <DataGridTextColumn Header="Our Price" Binding="{Binding Price}" Width="100">
                                            <DataGridTextColumn.ElementStyle>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="Foreground" Value="{DynamicResource SuccessButton}"/>
                                                    <Setter Property="FontWeight" Value="Bold"/>
                                                </Style>
                                            </DataGridTextColumn.ElementStyle>
                                        </DataGridTextColumn>
                                        <DataGridTextColumn Header="Savings" Binding="{Binding SavingsText}" Width="80">
                                            <DataGridTextColumn.ElementStyle>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="Foreground" Value="{DynamicResource PrimaryButton}"/>
                                                    <Setter Property="FontWeight" Value="Bold"/>
                                                </Style>
                                            </DataGridTextColumn.ElementStyle>
                                        </DataGridTextColumn>
                                        <DataGridTextColumn Header="Qty" Binding="{Binding QuantityDisplay}" Width="80"/>
                                        <DataGridTextColumn Header="Category" Binding="{Binding Category}" Width="100"/>
                                        <DataGridTextColumn Header="Status" Binding="{Binding StockStatus}" Width="100">
                                            <DataGridTextColumn.ElementStyle>
                                                <Style TargetType="TextBlock">
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding IsOutOfStock}" Value="True">
                                                            <Setter Property="Foreground" Value="{DynamicResource DangerButton}"/>
                                                            <Setter Property="FontWeight" Value="Bold"/>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding IsLowStock}" Value="True">
                                                            <Setter Property="Foreground" Value="{DynamicResource WarningButton}"/>
                                                            <Setter Property="FontWeight" Value="Bold"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </DataGridTextColumn.ElementStyle>
                                        </DataGridTextColumn>
                                    </DataGrid.Columns>
                                </DataGrid>
                            </Grid>
                        </Border>
                    </Grid>
                </Border>

                <!-- Right Panel: Product Details -->
                <Border Grid.Column="1" Background="{DynamicResource CardBackground}" CornerRadius="12" 
                        Effect="{DynamicResource ModernCardShadow}">
                    <Grid Margin="15">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- Product Details Header -->
                        <Border Grid.Row="0" Background="{DynamicResource PrimaryButton}" CornerRadius="8" Padding="12" Margin="0,0,0,10">
                            <StackPanel>
                                <TextBlock Text="ðŸ›ï¸ Product Details" 
                                           FontSize="16" FontWeight="Bold" 
                                           Foreground="White" HorizontalAlignment="Center"/>
                                <TextBlock Text="View and edit product information" 
                                           FontSize="10" Foreground="White" 
                                           HorizontalAlignment="Center" Margin="0,3,0,0" Opacity="0.9"/>
                            </StackPanel>
                        </Border>

                        <!-- Product Details Form with ScrollViewer -->
                        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Auto">
                            <StackPanel Margin="0,0,0,10">
                                <!-- Product Name -->
                                <Border Background="{DynamicResource SecondaryBackground}" CornerRadius="6" Padding="10" Margin="0,0,0,8">
                                    <StackPanel>
                                        <TextBlock Text="ðŸ“ Product Name" FontWeight="SemiBold" Margin="0,0,0,5" 
                                                   Foreground="{DynamicResource PrimaryText}" FontSize="12"/>
                                        <TextBox Text="{Binding ProductName}" 
                                                 FontSize="12" Padding="8,6" BorderThickness="0"
                                                 Background="Transparent" Foreground="{DynamicResource PrimaryText}"
                                                 Style="{DynamicResource ModernTextBox}"/>
                                    </StackPanel>
                                </Border>

                                <!-- Barcode -->
                                <Border Background="{DynamicResource SecondaryBackground}" CornerRadius="6" Padding="10" Margin="0,0,0,8">
                                    <StackPanel>
                                        <TextBlock Text="ðŸ·ï¸ Barcode" FontWeight="SemiBold" Margin="0,0,0,5" 
                                                   Foreground="{DynamicResource PrimaryText}" FontSize="12"/>
                                        <TextBox Text="{Binding ProductBarcode}" 
                                                 FontSize="12" Padding="8,6" BorderThickness="0"
                                                 Background="Transparent" Foreground="{DynamicResource PrimaryText}"
                                                 Style="{DynamicResource ModernTextBox}"/>
                                    </StackPanel>
                                </Border>

                                <!-- Marked Price -->
                                <Border Background="{DynamicResource SecondaryBackground}" CornerRadius="6" Padding="10" Margin="0,0,0,8">
                                    <StackPanel>
                                        <TextBlock Text="ðŸª Marked Price (Rs.)" FontWeight="SemiBold" Margin="0,0,0,5" 
                                                   Foreground="{DynamicResource PrimaryText}" FontSize="12"/>
                                        <TextBox Text="{Binding ProductMarkedPrice}" 
                                                 FontSize="12" Padding="8,6" BorderThickness="0"
                                                 Background="Transparent" Foreground="{DynamicResource PrimaryText}"
                                                 Style="{DynamicResource ModernTextBox}"/>
                                    </StackPanel>
                                </Border>

                                <!-- Our Price -->
                                <Border Background="{DynamicResource SecondaryBackground}" CornerRadius="6" Padding="10" Margin="0,0,0,8">
                                    <StackPanel>
                                        <TextBlock Text="ðŸ’° Our Price (Rs.)" FontWeight="SemiBold" Margin="0,0,0,5" 
                                                   Foreground="{DynamicResource PrimaryText}" FontSize="12"/>
                                        <TextBox Text="{Binding ProductPrice}" 
                                                 FontSize="12" Padding="8,6" BorderThickness="0"
                                                 Background="Transparent" Foreground="{DynamicResource PrimaryText}"
                                                 Style="{DynamicResource ModernTextBox}"/>
                                    </StackPanel>
                                </Border>

                                <!-- Quantity -->
                                <Border Background="{DynamicResource SecondaryBackground}" CornerRadius="6" Padding="10" Margin="0,0,0,8">
                                    <StackPanel>
                                        <TextBlock Text="ðŸ“¦ Quantity" FontWeight="SemiBold" Margin="0,0,0,5" 
                                                   Foreground="{DynamicResource PrimaryText}" FontSize="12"/>
                                        <TextBox Text="{Binding ProductQuantity}" 
                                                 FontSize="12" Padding="8,6" BorderThickness="0"
                                                 Background="Transparent" Foreground="{DynamicResource PrimaryText}"
                                                 Style="{DynamicResource ModernTextBox}"/>
                                    </StackPanel>
                                </Border>

                                <!-- Category -->
                                <Border Background="{DynamicResource SecondaryBackground}" CornerRadius="6" Padding="10" Margin="0,0,0,8">
                                    <StackPanel>
                                        <TextBlock Text="ðŸ“‚ Category" FontWeight="SemiBold" Margin="0,0,0,5" 
                                                   Foreground="{DynamicResource PrimaryText}" FontSize="12"/>
                                        <TextBox Text="{Binding ProductCategory}" 
                                                 FontSize="12" Padding="8,6" BorderThickness="0"
                                                 Background="Transparent" Foreground="{DynamicResource PrimaryText}"
                                                 Style="{DynamicResource ModernTextBox}"/>
                                    </StackPanel>
                                </Border>

                                <!-- Supplier -->
                                <Border Background="{DynamicResource SecondaryBackground}" CornerRadius="6" Padding="10" Margin="0,0,0,8">
                                    <StackPanel>
                                        <TextBlock Text="ðŸ¢ Supplier" FontWeight="SemiBold" Margin="0,0,0,5" 
                                                   Foreground="{DynamicResource PrimaryText}" FontSize="12"/>
                                        <TextBox Text="{Binding ProductSupplier}" 
                                                 FontSize="12" Padding="8,6" BorderThickness="0"
                                                 Background="Transparent" Foreground="{DynamicResource PrimaryText}"
                                                 Style="{DynamicResource ModernTextBox}"/>
                                    </StackPanel>
                                </Border>

                                <!-- Reorder Level -->
                                <Border Background="{DynamicResource SecondaryBackground}" CornerRadius="6" Padding="10" Margin="0,0,0,8">
                                    <StackPanel>
                                        <TextBlock Text="âš ï¸ Reorder Level" FontWeight="SemiBold" Margin="0,0,0,5" 
                                                   Foreground="{DynamicResource PrimaryText}" FontSize="12"/>
                                        <TextBox Text="{Binding ProductReorderLevel}" 
                                                 FontSize="12" Padding="8,6" BorderThickness="0"
                                                 Background="Transparent" Foreground="{DynamicResource PrimaryText}"
                                                 Style="{DynamicResource ModernTextBox}"/>
                                    </StackPanel>
                                </Border>

                                <!-- Description -->
                                <Border Background="{DynamicResource SecondaryBackground}" CornerRadius="6" Padding="10" Margin="0,0,0,15">
                                    <StackPanel>
                                        <TextBlock Text="ðŸ“„ Description" FontWeight="SemiBold" Margin="0,0,0,5" 
                                                   Foreground="{DynamicResource PrimaryText}" FontSize="12"/>
                                        <TextBox Text="{Binding ProductDescription}" 
                                                 Height="60" TextWrapping="Wrap"
                                                 FontSize="12" Padding="8,6" BorderThickness="0"
                                                 Background="Transparent" Foreground="{DynamicResource PrimaryText}"
                                                 Style="{DynamicResource ModernTextBox}"/>
                                    </StackPanel>
                                </Border>

                                <!-- Action Buttons -->
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,0,10">
                                    <Button Content="ðŸ“‹ Load Details" Command="{Binding LoadDetailsCommand}" 
                                            Width="110" Height="35" Margin="0,0,8,0" 
                                            Background="{DynamicResource InfoButton}" Foreground="White"
                                            FontWeight="Bold" FontSize="12"
                                            Style="{DynamicResource ModernButton}"/>
                                    <Button Content="âœï¸ Update" Command="{Binding UpdateProductCommand}" 
                                            Width="90" Height="35" Margin="0,0,8,0" 
                                            Background="{DynamicResource WarningButton}" Foreground="White"
                                            FontWeight="Bold" FontSize="12"
                                            Style="{DynamicResource ModernButton}"/>
                                </StackPanel>

                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                    <Button Content="ðŸ—‘ï¸ Delete" Command="{Binding DeleteProductCommand}" 
                                            Width="90" Height="35" Margin="0,0,8,0" 
                                            Background="{DynamicResource DangerButton}" Foreground="White"
                                            FontWeight="Bold" FontSize="12"
                                            Style="{DynamicResource ModernButton}"/>
                                    <Button Content="ðŸ”„ Clear" Command="{Binding ClearFormCommand}" 
                                            Width="90" Height="35" 
                                            Background="{DynamicResource SecondaryText}" Foreground="White"
                                            FontWeight="Bold" FontSize="12"
                                            Style="{DynamicResource ModernButton}"/>
                                </StackPanel>
                            </StackPanel>
                        </ScrollViewer>
                    </Grid>
                </Border>
            </Grid>

            <!-- Low Stock Alert Footer -->
            <Border Grid.Row="2" Background="{DynamicResource WarningButton}" CornerRadius="8" 
                    Margin="0,20,0,0" Padding="20" Opacity="0.9">
                <StackPanel>
                    <TextBlock Text="âš ï¸ Low Stock Alert" FontWeight="Bold" FontSize="16" 
                               Foreground="White" HorizontalAlignment="Center"/>
                    <TextBlock Text="Some products are running low on stock. Please review and reorder as needed." 
                               Foreground="White" HorizontalAlignment="Center" Margin="0,8,0,0" 
                               FontSize="14" TextWrapping="Wrap"/>
                </StackPanel>
            </Border>
        </Grid>
    </ScrollViewer>
</UserControl> 