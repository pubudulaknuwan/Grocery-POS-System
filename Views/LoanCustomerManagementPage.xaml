<UserControl x:Class="VillageSmartPOS.Views.LoanCustomerManagementPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:vm="clr-namespace:VillageSmartPOS.ViewModels"
      Background="{DynamicResource PrimaryBackground}">
    
    <UserControl.DataContext>
        <vm:LoanCustomerViewModel />
    </UserControl.DataContext>

    <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Auto" 
                  VerticalAlignment="Stretch" HorizontalAlignment="Stretch">
        <Grid Margin="20" MinWidth="800">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Background="{DynamicResource SuccessButton}" CornerRadius="8" Padding="20" Margin="0,0,0,20">
            <StackPanel>
                <TextBlock Text="💰 Loan Customer Management" 
                           FontSize="24" FontWeight="Bold" 
                           Foreground="White" HorizontalAlignment="Center"/>
                <TextBlock Text="Manage loan customers, track balances, and record repayments" 
                           FontSize="12" Foreground="White" 
                           HorizontalAlignment="Center" Margin="0,5,0,0"/>
            </StackPanel>
        </Border>

        <!-- Main Content -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="3*" MinWidth="500"/>
                <ColumnDefinition Width="2*" MinWidth="300"/>
            </Grid.ColumnDefinitions>

                         <!-- Left Panel - Customer List and Search -->
             <Border Grid.Column="0" Background="{DynamicResource CardBackground}" CornerRadius="8" Margin="0,0,10,0">
                 <Grid Margin="15">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                                         <!-- Search Section -->
                     <StackPanel Grid.Row="0" Margin="0,0,0,15">
                         <TextBlock Text="🔍 Search Customers" FontSize="16" FontWeight="Bold" Margin="0,0,0,10" Foreground="{DynamicResource PrimaryText}"/>
                         <Grid>
                             <Grid.ColumnDefinitions>
                                 <ColumnDefinition Width="*"/>
                                 <ColumnDefinition Width="Auto"/>
                             </Grid.ColumnDefinitions>
                             <TextBox Grid.Column="0" Text="{Binding SearchTerm, UpdateSourceTrigger=PropertyChanged}" 
                                      FontSize="14" Padding="10" Margin="0,0,10,0"
                                      VerticalContentAlignment="Center" Background="{DynamicResource CardBackground}" BorderBrush="{DynamicResource InputBorder}" Foreground="{DynamicResource PrimaryText}"/>
                            <Button Grid.Column="1" Content="🔄 Refresh" 
                                    Command="{Binding ClearFormCommand}" 
                                    Background="{DynamicResource SuccessButton}" Foreground="White" 
                                    FontWeight="Bold" Padding="15,8"/>
                        </Grid>
                    </StackPanel>

                                         <!-- Customer List -->
                     <StackPanel Grid.Row="1" Margin="0,0,0,15">
                         <TextBlock Text="📋 Customer List" FontSize="16" FontWeight="Bold" Margin="0,0,0,10" Foreground="{DynamicResource PrimaryText}"/>
                                                 <DataGrid ItemsSource="{Binding Customers}" 
                                   SelectedItem="{Binding SelectedCustomer}"
                                   AutoGenerateColumns="False" 
                                   CanUserAddRows="False"
                                   CanUserDeleteRows="False"
                                   IsReadOnly="True"
                                   GridLinesVisibility="Horizontal"
                                   HeadersVisibility="Column"
                                   RowBackground="{DynamicResource CardBackground}"
                                   AlternatingRowBackground="{DynamicResource SecondaryBackground}"
                                                                                                          Background="{DynamicResource CardBackground}"
                                    BorderBrush="{DynamicResource BorderColor}"
                                    MinHeight="200" MaxHeight="400">
                             <DataGrid.Resources>
                                 <!-- DataGrid Header Style -->
                                 <Style TargetType="DataGridColumnHeader">
                                     <Setter Property="Background" Value="{DynamicResource SecondaryBackground}"/>
                                     <Setter Property="Foreground" Value="{DynamicResource PrimaryText}"/>
                                     <Setter Property="BorderBrush" Value="{DynamicResource BorderColor}"/>
                                     <Setter Property="BorderThickness" Value="0,0,1,1"/>
                                     <Setter Property="Padding" Value="8,4"/>
                                     <Setter Property="FontWeight" Value="SemiBold"/>
                                 </Style>
                                 
                                 <!-- DataGrid Row Style -->
                                 <Style TargetType="DataGridRow">
                                     <Setter Property="Background" Value="{DynamicResource CardBackground}"/>
                                     <Setter Property="Foreground" Value="{DynamicResource PrimaryText}"/>
                                     <Style.Triggers>
                                         <Trigger Property="IsSelected" Value="True">
                                             <Setter Property="Background" Value="{DynamicResource PrimaryButton}"/>
                                             <Setter Property="Foreground" Value="White"/>
                                         </Trigger>
                                         <Trigger Property="IsMouseOver" Value="True">
                                             <Setter Property="Background" Value="{DynamicResource SecondaryBackground}"/>
                                         </Trigger>
                                     </Style.Triggers>
                                 </Style>
                             </DataGrid.Resources>
                             <DataGrid.Columns>
                                <DataGridTextColumn Header="Customer ID" Binding="{Binding CustomerId}" Width="100"/>
                                <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="150"/>
                                <DataGridTextColumn Header="Phone" Binding="{Binding PhoneDisplay}" Width="120"/>
                                <DataGridTextColumn Header="Balance" Binding="{Binding BalanceText}" Width="100"/>
                                <DataGridTextColumn Header="Address" Binding="{Binding AddressDisplay}" Width="200"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </StackPanel>

                                         <!-- Transaction History -->
                     <StackPanel Grid.Row="2">
                         <TextBlock Text="📊 Transaction History" FontSize="16" FontWeight="Bold" Margin="0,0,0,10" Foreground="{DynamicResource PrimaryText}"/>
                                                 <DataGrid ItemsSource="{Binding Transactions}" 
                                   AutoGenerateColumns="False" 
                                   CanUserAddRows="False"
                                   CanUserDeleteRows="False"
                                   IsReadOnly="True"
                                   GridLinesVisibility="Horizontal"
                                   HeadersVisibility="Column"
                                   RowBackground="{DynamicResource CardBackground}"
                                   AlternatingRowBackground="{DynamicResource SecondaryBackground}"
                                                                                                          Background="{DynamicResource CardBackground}"
                                    BorderBrush="{DynamicResource BorderColor}"
                                    MinHeight="150" MaxHeight="300">
                             <DataGrid.Resources>
                                 <!-- DataGrid Header Style -->
                                 <Style TargetType="DataGridColumnHeader">
                                     <Setter Property="Background" Value="{DynamicResource SecondaryBackground}"/>
                                     <Setter Property="Foreground" Value="{DynamicResource PrimaryText}"/>
                                     <Setter Property="BorderBrush" Value="{DynamicResource BorderColor}"/>
                                     <Setter Property="BorderThickness" Value="0,0,1,1"/>
                                     <Setter Property="Padding" Value="8,4"/>
                                     <Setter Property="FontWeight" Value="SemiBold"/>
                                 </Style>
                                 
                                 <!-- DataGrid Row Style -->
                                 <Style TargetType="DataGridRow">
                                     <Setter Property="Background" Value="{DynamicResource CardBackground}"/>
                                     <Setter Property="Foreground" Value="{DynamicResource PrimaryText}"/>
                                     <Style.Triggers>
                                         <Trigger Property="IsSelected" Value="True">
                                             <Setter Property="Background" Value="{DynamicResource PrimaryButton}"/>
                                             <Setter Property="Foreground" Value="White"/>
                                         </Trigger>
                                         <Trigger Property="IsMouseOver" Value="True">
                                             <Setter Property="Background" Value="{DynamicResource SecondaryBackground}"/>
                                         </Trigger>
                                     </Style.Triggers>
                                 </Style>
                             </DataGrid.Resources>
                             <DataGrid.Columns>
                                <DataGridTextColumn Header="Date" Binding="{Binding DateText}" Width="120"/>
                                <DataGridTextColumn Header="Type" Binding="{Binding TransactionTypeText}" Width="80"/>
                                <DataGridTextColumn Header="Amount" Binding="{Binding AmountText}" Width="80"/>
                                <DataGridTextColumn Header="Old Balance" Binding="{Binding OldBalanceText}" Width="100"/>
                                <DataGridTextColumn Header="New Balance" Binding="{Binding NewBalanceText}" Width="100"/>
                                <DataGridTextColumn Header="Notes" Binding="{Binding Notes}" Width="150"/>
                            </DataGrid.Columns>
                        </DataGrid>
                                         </StackPanel>
                 </Grid>
             </Border>

                                                                                                       <!-- Right Panel - Customer Form and Actions -->
               <Border Grid.Column="1" Background="{DynamicResource CardBackground}" CornerRadius="8" Margin="10,0,0,0">
                  <StackPanel Margin="15">
                                                 <!-- Customer Form -->
                         <TextBlock Text="👤 Customer Details" FontSize="16" FontWeight="Bold" Margin="0,0,0,15" Foreground="{DynamicResource PrimaryText}"/>
                        
                        <StackPanel Margin="0,0,0,20">
                                                         <TextBlock Text="Customer ID" FontWeight="SemiBold" Margin="0,0,0,5" Foreground="{DynamicResource PrimaryText}"/>
                             <TextBox Text="{Binding CustomerId, UpdateSourceTrigger=PropertyChanged}" 
                                      FontSize="14" Padding="8" Margin="0,0,0,10" Background="{DynamicResource CardBackground}" BorderBrush="{DynamicResource InputBorder}" Foreground="{DynamicResource PrimaryText}"/>

                             <TextBlock Text="Customer Name" FontWeight="SemiBold" Margin="0,0,0,5" Foreground="{DynamicResource PrimaryText}"/>
                             <TextBox Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}" 
                                      FontSize="14" Padding="8" Margin="0,0,0,10" Background="{DynamicResource CardBackground}" BorderBrush="{DynamicResource InputBorder}" Foreground="{DynamicResource PrimaryText}"/>

                             <TextBlock Text="Phone" FontWeight="SemiBold" Margin="0,0,0,5" Foreground="{DynamicResource PrimaryText}"/>
                             <TextBox Text="{Binding Phone, UpdateSourceTrigger=PropertyChanged}" 
                                      FontSize="14" Padding="8" Margin="0,0,0,10" Background="{DynamicResource CardBackground}" BorderBrush="{DynamicResource InputBorder}" Foreground="{DynamicResource PrimaryText}"/>

                             <TextBlock Text="Address" FontWeight="SemiBold" Margin="0,0,0,5" Foreground="{DynamicResource PrimaryText}"/>
                             <TextBox Text="{Binding Address, UpdateSourceTrigger=PropertyChanged}" 
                                      FontSize="14" Padding="8" Margin="0,0,0,10" 
                                      TextWrapping="Wrap" AcceptsReturn="True" Height="60" Background="{DynamicResource CardBackground}" BorderBrush="{DynamicResource InputBorder}" Foreground="{DynamicResource PrimaryText}"/>
                        </StackPanel>

                                                 <!-- Action Buttons -->
                         <StackPanel Margin="0,0,0,20">
                             <Button Content="➕ Add Customer" 
                                     Command="{Binding AddCustomerCommand}"
                                     Background="{DynamicResource SuccessButton}" Foreground="White" 
                                     FontWeight="Bold" Padding="10" Margin="0,0,0,10"/>
                             
                             <Button Content="✏️ Update Customer" 
                                     Command="{Binding UpdateCustomerCommand}"
                                     Background="{DynamicResource PrimaryButton}" Foreground="White" 
                                     FontWeight="Bold" Padding="10" Margin="0,0,0,10"/>
                             
                             <Button Content="🗑️ Delete Customer" 
                                     Command="{Binding DeleteCustomerCommand}"
                                     Background="{DynamicResource DangerButton}" Foreground="White" 
                                     FontWeight="Bold" Padding="10" Margin="0,0,0,10"/>
                             
                                                          <Button Content="🔄 Clear Form" 
                                     Command="{Binding ClearFormCommand}"
                                     Background="{DynamicResource WarningButton}" Foreground="White" 
                                     FontWeight="Bold" Padding="10" Margin="0,0,0,10"/>
                             
                             <Button Content="🧹 Cleanup Old Transactions" 
                                     Command="{Binding CleanupTransactionsCommand}"
                                     Background="{DynamicResource InfoButton}" Foreground="White" 
                                     FontWeight="Bold" Padding="10" Margin="0,0,0,10"/>

                             
                             

                         </StackPanel>

                                                                                                   <!-- Repayment Section -->
                          <Border Background="{DynamicResource SuccessButton}" CornerRadius="8" Padding="15" Margin="0,0,0,20" Opacity="1" MinHeight="150" MaxHeight="200">
                              <StackPanel>
                                  <TextBlock Text="💰 Add Repayment" FontSize="16" FontWeight="Bold" Margin="0,0,0,15" Foreground="White"/>
                                  
                                  <TextBlock Text="Repayment Amount" FontWeight="SemiBold" Margin="0,0,0,5" Foreground="White"/>
                                  <TextBox Text="{Binding RepaymentAmount, UpdateSourceTrigger=PropertyChanged}" 
                                           FontSize="14" Padding="8" Margin="0,0,0,15" Background="{DynamicResource CardBackground}" BorderBrush="{DynamicResource InputBorder}" Foreground="{DynamicResource PrimaryText}"/>
                                  
                                  <Button Content="💳 Add Repayment" 
                                          Command="{Binding AddRepaymentCommand}"
                                          Background="{DynamicResource SuccessButton}" Foreground="White" 
                                          FontWeight="Bold" Padding="10"/>
                              </StackPanel>
                          </Border>

                                                                                                   <!-- Status Information -->
                          <Border Background="{DynamicResource WarningButton}" CornerRadius="8" Padding="15" Opacity="1" MinHeight="150" MaxHeight="200">
                              <StackPanel>
                                  <TextBlock Text="ℹ️ Information" FontSize="14" FontWeight="Bold" Margin="0,0,0,10" Foreground="White"/>
                                  <TextBlock Text="• Select a customer to view details and transactions" 
                                             FontSize="12" Margin="0,0,0,5" Foreground="White"/>
                                  <TextBlock Text="• Use the search box to find customers quickly" 
                                             FontSize="12" Margin="0,0,0,5" Foreground="White"/>
                                  <TextBlock Text="• Add repayments to reduce customer balances" 
                                             FontSize="12" Margin="0,0,0,5" Foreground="White"/>
                                  <TextBlock Text="• All transactions are automatically logged" 
                                             FontSize="12" Margin="0,0,0,5" Foreground="White"/>
                                                            </StackPanel>
                          </Border>
                          

                     </StackPanel>
                 </Border>
        </Grid>

                 <!-- Footer -->
         <Border Grid.Row="2" Background="{DynamicResource SuccessButton}" CornerRadius="8" Padding="15" Margin="0,20,0,0" Opacity="1">
                             <TextBlock Text="💡 Tip: Loan customers can be used in the payment dialog when processing bills" 
                        FontSize="12" HorizontalAlignment="Center" FontStyle="Italic" Foreground="White"/>
         </Border>
    </Grid>
    </ScrollViewer>
</UserControl> 